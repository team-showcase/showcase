"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const decorators_1 = require("../../../common/decoration/decorators");
const utils_1 = require("../../../common/utils");
/**
 * Transfers settings from manifest to object page config
 * @param configPart - part of the configuration to be filled
 * @param manifest - manifest.json of the app
 * @param jsonSchema - app specific schema
 * @param pageID - ID of the given object page
 * @param sectionId (optional) - ID of the given section (optional)
 */
function transferSettingsOfObject(configPart, manifest, jsonSchema, pageName, sectionId) {
    if (!jsonSchema) {
        return;
    }
    let manifestSection = {}, value;
    for (const key in jsonSchema['properties']) {
        const exportPropertyRule = decorators_1.getReflectMetadata(configPart, key);
        if (exportPropertyRule && exportPropertyRule.manifest) {
            const targetAnnotationEncoded = sectionId && sectionId.replace('/', '::');
            const path = exportPropertyRule.manifest.path([pageName], targetAnnotationEncoded);
            manifestSection = utils_1.getManifestSectionByPathV4(manifest, path, sectionId, targetAnnotationEncoded);
            value = exportPropertyRule.manifest.import
                ? exportPropertyRule.manifest.import(manifestSection, sectionId)
                : exportPropertyRule.manifest.key
                    ? manifestSection[exportPropertyRule.manifest.key]
                    : manifestSection[key];
            if (value !== undefined) {
                configPart[key] = value;
            }
            else {
                delete configPart[key];
            }
        }
    }
}
exports.transferSettingsOfObject = transferSettingsOfObject;
//# sourceMappingURL=index.js.map